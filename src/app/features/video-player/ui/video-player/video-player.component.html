<div class="video-player-container" role="application" aria-label="Lecteur vid√©o YouTube avec contr√¥les de boucles">
  
  <!-- Live regions pour les annonces d'accessibilit√© -->
  <div class="sr-only" aria-live="polite" aria-atomic="true" id="video-status-announcements"></div>
  <div class="sr-only" aria-live="assertive" aria-atomic="true" id="video-error-announcements"></div>
  
  <!-- URL Input Section -->
  <section class="url-input-section" role="region" aria-labelledby="url-input-heading">
    <h2 id="url-input-heading">Charger une vid√©o YouTube</h2>
    <div class="input-group" role="group" aria-labelledby="url-input-heading">
      <input 
        type="url"
        [formControl]="urlControl"
        placeholder="Collez l'URL de la vid√©o YouTube ici..."
        class="url-input"
        [class.valid]="facade.isValidUrl()"
        [class.invalid]="urlControl.value && !facade.isValidUrl()"
        [attr.aria-label]="'URL de la vid√©o YouTube' + (facade.isValidUrl() ? ', URL valide' : urlControl.value ? ', URL invalide' : '')"
        [attr.aria-describedby]="(urlControl.value && !facade.isValidUrl()) ? 'url-error-message' : 'url-help-text'"
        [attr.aria-invalid]="urlControl.value && !facade.isValidUrl()"
        autocomplete="url"
        spellcheck="false"
      >
      <button 
        type="button"
        (click)="loadVideo()"
        [disabled]="!facade.isValidUrl() || loading()"
        class="load-button"
        [attr.aria-label]="loading() ? 'Chargement de la vid√©o en cours' : 'Charger la vid√©o YouTube'"
        [attr.aria-describedby]="loading() ? 'loading-status' : null"
      >
        @if (loading()) {
          <span class="loading-spinner"></span>
          Chargement...
        } @else {
          Charger
        }
      </button>
    </div>
    
    <div id="url-help-text" class="help-text sr-only">
      Entrez une URL vid√©o YouTube valide. Formats accept√©s : youtube.com/watch?v=ID, youtu.be/ID, ou youtube.com/embed/ID
    </div>
    
    @if (urlControl.value && !facade.isValidUrl()) {
      <div id="url-error-message" 
           class="error-message" 
           role="alert" 
           aria-live="polite">
        URL YouTube invalide. Formats support√©s : youtube.com/watch?v=..., youtu.be/..., youtube.com/embed/...
      </div>
    }
    
    @if (loading()) {
      <div id="loading-status" 
           class="loading-status" 
           role="status" 
           aria-live="polite">
        Chargement de la vid√©o en cours...
      </div>
    }
  </section>
  <!-- Video Player Section -->
  <section class="player-section" role="region" [attr.aria-label]="facade.vm().currentVideo ? 'Lecteur vid√©o - ' + facade.vm().currentVideo?.title : 'Lecteur vid√©o'">
    @if (facade.vm().currentVideo) {
      <div class="video-container">
        <!-- YouTube Player Container with responsive iframe -->
        <div class="player-wrapper" 
             (mouseenter)="onPlayerMouseEnter()"
             (mouseleave)="onPlayerMouseLeave()"
             (click)="onPlayerTouch()"
             (touchstart)="onPlayerTouch()"
             role="region" 
             [attr.aria-label]="'Lecteur vid√©o YouTube - ' + (facade.vm().currentVideo?.title || 'Vid√©o')">
          <iframe
            #youtubePlayer
            id="youtube-player"
            class="youtube-iframe"
            [src]="getYouTubeEmbedUrl()"
            title="YouTube video player"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen>
          </iframe>
          
          <!-- Loading State Overlay -->
          @if (isVideoLoading()) {
            <div class="loading-overlay">
              <div class="loading-content">
                <div class="loading-spinner-large">
                  <div class="spinner-ring"></div>
                </div>
                <div class="loading-text">Chargement de la vid√©o...</div>
                <div class="loading-dots">
                  <div class="dot"></div>
                  <div class="dot"></div>
                  <div class="dot"></div>
                  <div class="dot"></div>
                </div>
              </div>
            </div>
          }

          <!-- Error State Overlay -->
          @if (facade.vm().hasError) {
            <div class="error-overlay">
              <div class="error-content">
                <div class="error-icon">‚ö†Ô∏è</div>
                <div class="error-text">{{ facade.vm().error }}</div>
                <button class="retry-button" (click)="retryVideo()">
                  R√©essayer
                </button>
              </div>
            </div>
          }

          <!-- Controls Overlay (visible on hover/touch when ready) -->
          @if (!isVideoLoading() && !facade.vm().hasError) {
            <div class="player-overlay" [class.show]="shouldShowOverlay()">
              <div class="overlay-gradient">
                <!-- Top overlay section for future features -->
                <div class="overlay-top">
                  <!-- Future: Volume, settings, etc. -->
                </div>
                
                <!-- Bottom overlay section with main controls -->
                <div class="overlay-bottom">
                  <div class="overlay-controls">
                    <app-player-controls 
                      [viewModel]="facade.vm()" 
                      class="overlay-player-controls">
                    </app-player-controls>

                    <app-speed-control
                      [currentRate]="facade.vm().playbackRate"
                      [disabled]="!facade.vm().isPlayerReady"
                      (rateChange)="setVideoPlaybackRate($event)"
                      (increaseSpeed)="facade.increaseSpeed()"
                      (decreaseSpeed)="facade.decreaseSpeed()"
                      class="overlay-speed-controls">
                    </app-speed-control>
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
        
        <!-- Video Info -->
        <div class="video-info">
          <h3>{{ facade.vm().currentVideo?.title }}</h3>
          <p class="video-meta">
            Dur√©e: {{ facade.vm().durationFormatted }} | 
            Auteur: {{ facade.vm().currentVideo?.author }}
          </p>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress-container">
        <div class="progress-bar">
          <div 
            class="progress-fill" 
            [style.width.%]="facade.getProgressPercentage()"
          ></div>
          <div 
            class="progress-handle"
            [style.left.%]="facade.getProgressPercentage()"
          ></div>
        </div>
        <div class="time-display">
          {{ facade.vm().currentTimeFormatted }} / 
          {{ facade.vm().durationFormatted }}
        </div>
      </div>

      <!-- Controls are now integrated in the overlay above -->

    } @else {
      <div class="empty-player">
        <div class="empty-state">
          <div class="empty-icon">üì∫</div>
          <h3>Aucune vid√©o charg√©e</h3>
          <p>Collez l'URL d'une vid√©o YouTube ci-dessus pour commencer</p>
        </div>
      </div>
    }
  </section>

  <!-- Error Display -->
  @if (facade.vm().hasError) {
    <div class="error-banner">
      <span class="error-icon">‚ö†Ô∏è</span>
      {{ facade.vm().error }}
    </div>
  }
</div>