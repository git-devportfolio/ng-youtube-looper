<div class="video-player-container">
  
  <!-- URL Input Section -->
  <div class="url-input-section">
    <h2>Charger une vid√©o YouTube</h2>
    <div class="input-group">
      <input 
        type="url"
        [formControl]="urlControl"
        placeholder="Collez l'URL de la vid√©o YouTube ici..."
        class="url-input"
        [class.valid]="facade.isValidUrl()"
        [class.invalid]="urlControl.value && !facade.isValidUrl()"
      >
      <button 
        type="button"
        (click)="loadVideo()"
        [disabled]="!facade.isValidUrl() || loading()"
        class="load-button"
      >
        @if (loading()) {
          <span class="loading-spinner"></span>
          Chargement...
        } @else {
          Charger
        }
      </button>
    </div>
    
    @if (urlControl.value && !facade.isValidUrl()) {
      <div class="error-message">
        URL YouTube invalide. Formats support√©s : youtube.com/watch?v=..., youtu.be/..., youtube.com/embed/...
      </div>
    }
  </div>

  <!-- Video Player Section -->
  <div class="player-section">
    @if (facade.vm().currentVideo) {
      <div class="video-container">
        <!-- YouTube Player Container with responsive iframe -->
        <div class="player-wrapper" 
             (mouseenter)="onPlayerMouseEnter()"
             (mouseleave)="onPlayerMouseLeave()"
             (click)="onPlayerTouch()"
             (touchstart)="onPlayerTouch()">
          <iframe
            #youtubePlayer
            id="youtube-player"
            class="youtube-iframe"
            [src]="getYouTubeEmbedUrl()"
            title="YouTube video player"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen>
          </iframe>
          
          <!-- Loading State Overlay -->
          @if (isVideoLoading()) {
            <div class="loading-overlay">
              <div class="loading-content">
                <div class="loading-spinner-large">
                  <div class="spinner-ring"></div>
                </div>
                <div class="loading-text">Chargement de la vid√©o...</div>
              </div>
            </div>
          }

          <!-- Error State Overlay -->
          @if (facade.vm().hasError) {
            <div class="error-overlay">
              <div class="error-content">
                <div class="error-icon">‚ö†Ô∏è</div>
                <div class="error-text">{{ facade.vm().playerState.error }}</div>
                <button class="retry-button" (click)="retryVideo()">
                  R√©essayer
                </button>
              </div>
            </div>
          }

          <!-- Controls Overlay (visible on hover/touch when ready) -->
          @if (!isVideoLoading() && !facade.vm().hasError) {
            <div class="player-overlay" [class.show]="shouldShowOverlay()">
              <div class="overlay-gradient">
                <!-- Top overlay section for future features -->
                <div class="overlay-top">
                  <!-- Future: Volume, settings, etc. -->
                </div>
                
                <!-- Bottom overlay section with main controls -->
                <div class="overlay-bottom">
                  <div class="overlay-controls">
                    <app-player-controls class="overlay-player-controls">
                    </app-player-controls>

                    <app-speed-control
                      [currentRate]="facade.vm().playerState.playbackRate"
                      [disabled]="!facade.vm().playerState.isReady"
                      (rateChange)="setVideoPlaybackRate($event)"
                      (increaseSpeed)="facade.increaseSpeed()"
                      (decreaseSpeed)="facade.decreaseSpeed()"
                      class="overlay-speed-controls">
                    </app-speed-control>
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
        
        <!-- Video Info -->
        <div class="video-info">
          <h3>{{ facade.vm().currentVideo.title }}</h3>
          <p class="video-meta">
            Dur√©e: {{ facade.formatTime(facade.vm().currentVideo.duration) }} | 
            Auteur: {{ facade.vm().currentVideo.author }}
          </p>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress-container">
        <div class="progress-bar">
          <div 
            class="progress-fill" 
            [style.width.%]="facade.getProgressPercentage()"
          ></div>
          <div 
            class="progress-handle"
            [style.left.%]="facade.getProgressPercentage()"
          ></div>
        </div>
        <div class="time-display">
          {{ facade.formatTime(facade.vm().playerState.currentTime) }} / 
          {{ facade.formatTime(facade.vm().playerState.duration) }}
        </div>
      </div>

      <!-- Controls are now integrated in the overlay above -->

    } @else {
      <div class="empty-player">
        <div class="empty-state">
          <div class="empty-icon">üì∫</div>
          <h3>Aucune vid√©o charg√©e</h3>
          <p>Collez l'URL d'une vid√©o YouTube ci-dessus pour commencer</p>
        </div>
      </div>
    }
  </div>

  <!-- Error Display -->
  @if (facade.vm().hasError) {
    <div class="error-banner">
      <span class="error-icon">‚ö†Ô∏è</span>
      {{ facade.vm().playerState.error }}
    </div>
  }
</div>