<div class="timeline-container"
     [class.loading]="isLoading"
     [class.disabled]="disabled"
     [class.ready]="isReady">
  
  <!-- Timeline Track -->
  <div class="timeline-track"
       (click)="onTrackClick($event)"
       (touchstart)="onTouchStart($event)"
       (touchend)="onTouchEnd($event)"
       [style.cursor]="isReady ? 'pointer' : 'default'">
    
    <!-- Background Track -->
    <div class="track-background"></div>
    
    <!-- Current Time Indicator Container -->
    <div class="current-time-indicator-container">
      <!-- Current Time Indicator with enhanced states -->
      <div class="current-time-indicator"
           [class]="indicatorClasses"
           [style.left.%]="currentTimePercentage"
           [attr.aria-label]="'Position: ' + formatDuration(currentTime)">
        <div class="indicator-circle"></div>
        <div class="indicator-line"></div>
      </div>
    </div>
    
    <!-- Loop Segments Container -->
    <div class="loop-segments-container">
      @for (loop of loops; track loop.id) {
        <div [class]="getLoopClasses(loop)"
             [attr.data-loop-id]="loop.id"
             [style.left.%]="getLoopPosition(loop).left"
             [style.width.%]="getLoopPosition(loop).width"
             (click)="onLoopClick($event, loop)"
             [attr.aria-label]="'Loop from ' + formatDuration(loop.startTime) + ' to ' + formatDuration(loop.endTime)">
          
          <!-- Left resize handle -->
          <div class="resize-handle left"
               (mousedown)="onLoopMouseDown($event, loop, 'resize-left')"
               [attr.aria-label]="'Resize loop start'">
          </div>
          
          <!-- Loop segment body -->
          <div class="loop-body"
               (mousedown)="onLoopMouseDown($event, loop, 'move')"
               [attr.aria-label]="'Move loop segment'">
            <span class="loop-label" *ngIf="loop.name">{{ loop.name }}</span>
            <div class="loop-times">
              <span class="start-time">{{ formatDuration(loop.startTime) }}</span>
              <span class="end-time">{{ formatDuration(loop.endTime) }}</span>
            </div>
          </div>
          
          <!-- Right resize handle -->
          <div class="resize-handle right"
               (mousedown)="onLoopMouseDown($event, loop, 'resize-right')"
               [attr.aria-label]="'Resize loop end'">
          </div>
        </div>
      }
    </div>
  </div>
  
  <!-- Timeline Labels (optional) -->
  <div class="timeline-labels" *ngIf="isReady">
    <span class="time-label start">0:00</span>
    <span class="time-label end">{{ formatDuration(duration) }}</span>
  </div>
  
  <!-- Loading State -->
  @if (isLoading) {
    <div class="timeline-loading">
      <div class="loading-shimmer"></div>
    </div>
  }
</div>