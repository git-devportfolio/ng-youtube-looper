<div id="player-controls" 
     class="player-controls"
     tabindex="-1" 
     [class.compact]="compact"
     [class.loading]="isLoadingValue"
     [class.error]="hasErrorValue">

  <!-- Time Display -->
  @if (showTimeDisplay) {
    <app-time-display
      [currentTime]="currentTime()"
      [duration]="duration()"
      [isLoading]="isLoadingValue"
      [hasError]="hasErrorValue"
      [showDuration]="duration() > 0"
      [class.compact]="compact">
    </app-time-display>
  }

  <!-- Time Slider -->
  @if (showSlider) {
    <app-time-slider
      [currentTime]="currentTime()"
      [duration]="duration()"
      [disabled]="controlsDisabledValue || !canSeekValue"
      [buffered]="buffered()"
      (seekTo)="seekTo($event)"
      (seekStart)="onSeekStart()"
      (seekEnd)="onSeekEnd()"
      [class.compact]="compact">
    </app-time-slider>
  }

  <!-- Main Controls -->
  <div class="main-controls">
    <!-- Seek Backward -->
    <button 
      type="button"
      class="control-button seek-button"
      (click)="seekBack()"
      [disabled]="controlsDisabledValue || !canSeekValue"
      [attr.aria-label]="'Reculer de 10 secondes (Ctrl+Flèche gauche ou J)'"
      title="Reculer de 10 secondes"
      tabindex="0"
    >
      <span class="control-icon">⏪</span>
      <span class="seek-label">-10s</span>
    </button>

    <!-- Play/Pause Toggle -->
    <button 
      type="button"
      class="control-button play-pause-button"
      [class.circular]="circular"
      [class.playing]="isPlayingValue"
      (click)="togglePlayPause()"
      [disabled]="controlsDisabledValue || (!canPlayValue && !canPauseValue)"
      [attr.aria-label]="(isPlayingValue ? 'Mettre en pause' : 'Lire') + ' (Espace ou K)'"
      [title]="isPlayingValue ? 'Mettre en pause' : 'Lire'"
      [attr.aria-pressed]="isPlayingValue"
      tabindex="0"
    >
      @if (isLoadingValue) {
        <span class="control-icon loading">⏳</span>
      } @else if (hasErrorValue) {
        <span class="control-icon error">❌</span>
      } @else if (isPlayingValue) {
        <span class="control-icon">⏸️</span>
      } @else {
        <span class="control-icon">▶️</span>
      }
    </button>

    <!-- Stop -->
    <button 
      type="button"
      class="control-button stop-button"
      (click)="stop()"
      [disabled]="controlsDisabledValue || !canSeekValue"
      [attr.aria-label]="'Arrêter la lecture'"
      title="Arrêter"
      tabindex="0"
    >
      <span class="control-icon">⏹️</span>
    </button>

    <!-- Seek Forward -->
    <button 
      type="button"
      class="control-button seek-button"
      (click)="seekForward()"
      [disabled]="controlsDisabledValue || !canSeekValue"
      [attr.aria-label]="'Avancer de 10 secondes (Ctrl+Flèche droite ou L)'"
      title="Avancer de 10 secondes"
      tabindex="0"
    >
      <span class="control-icon">⏩</span>
      <span class="seek-label">+10s</span>
    </button>
  </div>

  <!-- Speed Controls -->
  @if (showSpeedControls) {
    <app-speed-control
      [currentRate]="playbackRate()"
      [disabled]="controlsDisabledValue"
      (rateChange)="setPlaybackRate($event)"
      (increaseSpeed)="increaseSpeed()"
      (decreaseSpeed)="decreaseSpeed()"
      [class.compact]="compact">
    </app-speed-control>
  }

  <!-- Error Message -->
  @if (hasErrorValue) {
    <div class="error-message">
      <span class="error-icon">⚠️</span>
      <span class="error-text">{{ viewModel.error || 'Erreur de lecture vidéo' }}</span>
    </div>
  }

  <!-- Loading Indicator -->
  @if (isLoadingValue) {
    <div class="loading-indicator">
      <span class="loading-icon">⏳</span>
      <span class="loading-text">Chargement...</span>
    </div>
  }
</div>