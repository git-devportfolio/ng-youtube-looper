<div class="speed-control" role="group" aria-label="Contr√¥les de vitesse de lecture">
  <div class="speed-label">
    <span class="label-text">Vitesse</span>
    <span class="current-speed" 
          [class.synchronized]="isSynchronized"
          [attr.aria-label]="'Vitesse actuelle: ' + currentRate + 'x' + (isSynchronized ? ', synchronis√©' : ', non synchronis√©')">
      <span class="speed-value" [attr.data-speed]="currentRate">{{ currentRate }}x</span>
      @if (!isSynchronized) {
        <small class="sync-indicator" 
               title="Non synchronis√© avec le player YouTube"
               aria-label="Non synchronis√©">‚ö†Ô∏è</small>
      } @else {
        <small class="sync-indicator synchronized" 
               title="Synchronis√© avec le player YouTube"
               aria-label="Synchronis√©">‚úì</small>
      }
    </span>
  </div>

  <!-- Preset Speed Buttons -->
  <div class="speed-presets" role="group" aria-label="Vitesses pr√©d√©finies">
    @for (preset of speedPresets; track preset.value) {
      <button
        type="button"
        class="speed-preset"
        [class.active]="currentRate === preset.value"
        [class.transitioning]="isTransitioning"
        [disabled]="disabled"
        (click)="setPresetSpeed(preset.value)"
        [title]="preset.label"
        [attr.aria-label]="preset.label + (currentRate === preset.value ? ', s√©lectionn√©' : '')"
        [attr.aria-pressed]="currentRate === preset.value"
      >
        <span class="preset-value">{{ preset.value }}x</span>
        @if (currentRate === preset.value) {
          <span class="active-indicator" aria-hidden="true">‚óè</span>
        }
      </button>
    }
  </div>

  <!-- Speed Control Buttons -->
  <div class="speed-buttons" role="group" aria-label="Contr√¥les de vitesse par √©tapes">
    <button
      type="button"
      class="speed-button decrease"
      [class.transitioning]="isTransitioning"
      [disabled]="disabled || !canDecrease"
      (click)="decreasePlaybackSpeed()"
      [title]="'Diminuer la vitesse (-' + validationService.PLAYBACK_SPEED_STEP + 'x)'"
      [attr.aria-label]="'Diminuer la vitesse de ' + validationService.PLAYBACK_SPEED_STEP + 'x, vitesse actuelle: ' + currentRate + 'x'"
    >
      <span class="speed-icon" aria-hidden="true">üêå</span>
      <span class="speed-text" aria-hidden="true">-</span>
    </button>

    <button
      type="button"
      class="speed-button increase"
      [class.transitioning]="isTransitioning"
      [disabled]="disabled || !canIncrease"
      (click)="increasePlaybackSpeed()"
      [title]="'Augmenter la vitesse (+' + validationService.PLAYBACK_SPEED_STEP + 'x)'"
      [attr.aria-label]="'Augmenter la vitesse de ' + validationService.PLAYBACK_SPEED_STEP + 'x, vitesse actuelle: ' + currentRate + 'x'"
    >
      <span class="speed-icon" aria-hidden="true">üê∞</span>
      <span class="speed-text" aria-hidden="true">+</span>
    </button>
  </div>

  <!-- Manual Input -->
  <div class="manual-input" 
       *ngIf="showManualInput"
       [@slideInOut]
       role="group" 
       aria-label="Saisie manuelle de vitesse">
    <label class="input-label" for="speed-manual-input">
      Vitesse personnalis√©e ({{ validationService.MIN_PLAYBACK_SPEED }}x - {{ validationService.MAX_PLAYBACK_SPEED }}x par pas de {{ validationService.PLAYBACK_SPEED_STEP }}x)
    </label>
    <div class="input-controls">
      <input
        type="number"
        id="speed-manual-input"
        [formControl]="manualSpeedControl"
        class="speed-input"
        [class.error]="manualInputError"
        [class.valid]="manualSpeedControl.valid && manualSpeedControl.value"
        placeholder="1.0"
        [min]="validationService.MIN_PLAYBACK_SPEED"
        [max]="validationService.MAX_PLAYBACK_SPEED"
        [step]="validationService.PLAYBACK_SPEED_STEP"
        autocomplete="off"
        [disabled]="disabled"
        [attr.aria-describedby]="manualInputError ? 'speed-input-error' : 'speed-input-help'"
        (keydown.enter)="applyManualSpeed()"
        (keydown.escape)="toggleManualInput()"
      >
      <button
        type="button"
        class="apply-button"
        [class.loading]="isTransitioning"
        [disabled]="disabled || manualInputError !== null"
        (click)="applyManualSpeed()"
        title="Appliquer la vitesse personnalis√©e (arrondie automatiquement)"
        aria-label="Appliquer la vitesse personnalis√©e"
      >
        @if (isTransitioning()) {
          <span class="spinner" aria-hidden="true">‚ü≥</span>
        } @else {
          <span aria-hidden="true">‚úì</span>
        }
      </button>
    </div>
    @if (manualInputError) {
      <div class="input-error" 
           id="speed-input-error" 
           role="alert" 
           aria-live="polite">{{ manualInputError }}</div>
    }
    <div class="input-help" id="speed-input-help" [hidden]="manualInputError">
      Utilisez Entr√©e pour appliquer, √âchap pour annuler
    </div>
  </div>

  <!-- YouTube Integration Status -->
  @if (useDirectIntegration) {
    <div class="integration-status" 
         [class.synchronized]="isSynchronized"
         [class.pulsing]="!isSynchronized"
         title="Int√©gration directe avec YouTube"
         role="status"
         [attr.aria-live]="isSynchronized ? 'off' : 'polite'">
      <span class="integration-icon" aria-hidden="true">üîó</span>
      @if (isSynchronized) {
        <span class="status-text synchronized">Synchronis√©</span>
        <div class="status-indicator synchronized" aria-hidden="true"></div>
      } @else {
        <span class="status-text not-synchronized">D√©synchronis√©</span>
        <div class="status-indicator not-synchronized" aria-hidden="true"></div>
      }
    </div>
  }

  <!-- Toggle Manual Input -->
  <button
    type="button"
    class="toggle-manual"
    [class.active]="showManualInput"
    [class.pulse]="showManualInput"
    (click)="toggleManualInput()"
    [disabled]="disabled"
    [title]="showManualInput ? 'Fermer la saisie manuelle' : 'Ouvrir la saisie manuelle'"
    [attr.aria-label]="showManualInput ? 'Fermer la saisie manuelle' : 'Ouvrir la saisie manuelle'"
    [attr.aria-expanded]="showManualInput"
  >
    <span class="toggle-icon" [attr.aria-hidden]="true">
      {{ showManualInput ? '‚å®Ô∏è' : '‚öôÔ∏è' }}
    </span>
  </button>

  <!-- Loop Speed Management Status -->
  @if (enableLoopSpeedManagement && activeLoopId) {
    <div class="loop-speed-status" 
         role="status"
         [title]="'Vitesse sp√©cifique pour la boucle: ' + activeLoopId"
         aria-label="Gestion de vitesse par boucle active">
      <span class="loop-icon" aria-hidden="true">üîÑ</span>
      <span class="loop-text">Boucle</span>
      <div class="loop-indicator active" aria-hidden="true"></div>
    </div>
  }
</div>