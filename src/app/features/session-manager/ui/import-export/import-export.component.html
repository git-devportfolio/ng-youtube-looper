<div class="import-export-container">
  
  <!-- Export Section -->
  <div class="section export-section">
    <div class="section-header">
      <h3 class="section-title">
        <span class="section-icon">üì§</span>
        Exporter des sessions
      </h3>
      <div class="section-description">
        Sauvegardez vos sessions au format JSON
      </div>
    </div>

    <div class="export-options">
      
      <!-- Export All Sessions -->
      <div class="option-card">
        <div class="option-header">
          <h4 class="option-title">Exporter toutes les sessions</h4>
          <div class="option-meta">
            {{ sessionCount() }} session{{ sessionCount() !== 1 ? 's' : '' }} disponible{{ sessionCount() !== 1 ? 's' : '' }}
          </div>
        </div>
        
        <button 
          class="export-btn primary"
          [disabled]="!canExportAll()"
          (click)="exportAllSessions()"
          [attr.aria-label]="'Exporter toutes les ' + sessionCount() + ' sessions'">
          @if (isExporting() && lastOperation() === 'export-all') {
            <span class="btn-spinner"></span>
            Export en cours...
          } @else {
            <span class="btn-icon">üì¶</span>
            Exporter tout
          }
        </button>
      </div>

      <!-- Export Selected Sessions -->
      @if (showBulkExport && hasSelectedSessions()) {
        <div class="option-card">
          <div class="option-header">
            <h4 class="option-title">Exporter les sessions s√©lectionn√©es</h4>
            <div class="option-meta">
              {{ getSelectedSessionsText() }}
            </div>
          </div>
          
          <button 
            class="export-btn secondary"
            [disabled]="!canExportSelected()"
            (click)="exportSelectedSessions()"
            [attr.aria-label]="'Exporter ' + getSelectedSessionsText()">
            @if (isExporting() && lastOperation() === 'export-selected') {
              <span class="btn-spinner"></span>
              Export en cours...
            } @else {
              <span class="btn-icon">üìã</span>
              Exporter la s√©lection
            }
          </button>
        </div>
      }

      <!-- Individual Session Export -->
      @if (sessionList().length > 0) {
        <div class="option-card individual-export">
          <div class="option-header">
            <h4 class="option-title">Exporter une session individuelle</h4>
            <div class="option-meta">
              Choisissez une session sp√©cifique √† exporter
            </div>
          </div>
          
          <div class="session-export-list">
            @for (session of getAvailableSessionsForExport(); track session.id) {
              <div class="session-export-item">
                <div class="session-info">
                  <div class="session-name">{{ session.name }}</div>
                  <div class="session-meta">{{ session.videoTitle }}</div>
                </div>
                <button 
                  class="export-btn mini"
                  [disabled]="isExporting()"
                  (click)="exportIndividualSession(session)"
                  [attr.aria-label]="'Exporter la session ' + session.name">
                  @if (isExporting() && lastOperation() === 'export-individual') {
                    <span class="btn-spinner"></span>
                  } @else {
                    <span class="btn-icon">üìÑ</span>
                    Exporter
                  }
                </button>
              </div>
            }
          </div>
        </div>
      }
    </div>
  </div>

  <!-- Import Section -->
  @if (showImport) {
    <div class="section import-section">
      <div class="section-header">
        <h3 class="section-title">
          <span class="section-icon">üì•</span>
          Importer des sessions
        </h3>
        <div class="section-description">
          Chargez des sessions depuis un fichier JSON
        </div>
      </div>

      <!-- File Input (Hidden) -->
      <input 
        #fileInput
        type="file"
        accept=".json"
        (change)="onFileSelected($event)"
        style="display: none"
        aria-label="S√©lectionner un fichier JSON √† importer">

      <!-- Import Options -->
      <div class="import-options">
        
        <!-- Import Button (only show if no preview) -->
        @if (!showPreview()) {
          <div class="option-card">
            <div class="option-header">
              <h4 class="option-title">Importer depuis un fichier</h4>
              <div class="option-meta">
                Formats support√©s : JSON (max 10MB)
              </div>
            </div>
            
            <button 
              class="import-btn primary"
              [disabled]="!canImport()"
              (click)="triggerImport()"
              [attr.aria-label]="'S√©lectionner un fichier JSON √† importer'">
              @if (isImporting()) {
                <span class="btn-spinner"></span>
                Import en cours...
              } @else {
                <span class="btn-icon">üìÅ</span>
                Choisir un fichier
              }
            </button>
          </div>

          <!-- Drag & Drop Zone -->
          <div class="drop-zone"
               [class.processing]="isImporting()"
               (dragover)="onDragOver($event)"
               (dragleave)="onDragLeave($event)"
               (drop)="onDrop($event)"
               [attr.aria-label]="'Zone de d√©p√¥t pour fichiers JSON'">
            
            <div class="drop-zone-content">
              @if (isImporting()) {
                <div class="drop-zone-spinner"></div>
                <div class="drop-zone-text">Import en cours...</div>
              } @else {
                <div class="drop-zone-icon">üìé</div>
                <div class="drop-zone-text">
                  <strong>Glissez-d√©posez un fichier JSON ici</strong>
                </div>
                <div class="drop-zone-hint">
                  ou utilisez le bouton "Choisir un fichier"
                </div>
              }
            </div>
          </div>
        }

        <!-- Import Preview -->
        @if (showPreview() && importPreview(); as preview) {
          <div class="import-preview-section">
            <div class="preview-header">
              <h4 class="preview-title">
                <span class="preview-icon">üîç</span>
                Aper√ßu de l'import
              </h4>
              <div class="preview-file-info">
                <span class="file-name">{{ preview.fileName }}</span>
                <span class="file-size">({{ getFormattedFileSize(preview.fileSize) }})</span>
              </div>
            </div>

            <div class="preview-content">
              <!-- Import Summary -->
              <div class="preview-summary">
                <div class="summary-stat">
                  <span class="stat-icon">üìã</span>
                  <span class="stat-text">{{ preview.sessionCount }} session{{ preview.sessionCount !== 1 ? 's' : '' }} trouv√©e{{ preview.sessionCount !== 1 ? 's' : '' }}</span>
                </div>
                
                @if (hasConflicts()) {
                  <div class="summary-stat conflicts">
                    <span class="stat-icon">‚ö†Ô∏è</span>
                    <span class="stat-text">{{ getConflictText() }}</span>
                  </div>
                }
                
                @if (preview.errors.length > 0) {
                  <div class="summary-stat errors">
                    <span class="stat-icon">‚ùå</span>
                    <span class="stat-text">{{ preview.errors.length }} erreur{{ preview.errors.length !== 1 ? 's' : '' }}</span>
                  </div>
                }
              </div>

              <!-- Import Mode Selection -->
              @if (hasConflicts()) {
                <div class="import-mode-section">
                  <h5 class="mode-title">Mode d'import :</h5>
                  <div class="mode-options">
                    <label class="mode-option">
                      <input 
                        type="radio" 
                        name="importMode" 
                        value="merge"
                        [checked]="importMode() === 'merge'"
                        (change)="setImportMode('merge')">
                      <span class="mode-label">
                        <strong>Fusionner</strong>
                        <span class="mode-description">Conserver les deux versions (renommer automatiquement)</span>
                      </span>
                    </label>
                    
                    <label class="mode-option">
                      <input 
                        type="radio" 
                        name="importMode" 
                        value="replace"
                        [checked]="importMode() === 'replace'"
                        (change)="setImportMode('replace')">
                      <span class="mode-label">
                        <strong>Remplacer</strong>
                        <span class="mode-description">√âcraser les sessions existantes</span>
                      </span>
                    </label>
                    
                    <label class="mode-option">
                      <input 
                        type="radio" 
                        name="importMode" 
                        value="skip-conflicts"
                        [checked]="importMode() === 'skip-conflicts'"
                        (change)="setImportMode('skip-conflicts')">
                      <span class="mode-label">
                        <strong>Ignorer conflits</strong>
                        <span class="mode-description">Ne pas importer les sessions en conflit</span>
                      </span>
                    </label>
                  </div>
                </div>
              }

              <!-- Session List Preview -->
              @if (preview.sessions.length > 0) {
                <div class="session-preview-list">
                  <h5 class="preview-list-title">Sessions √† importer :</h5>
                  <div class="preview-sessions">
                    @for (session of preview.sessions.slice(0, 5); track session.id) {
                      <div class="preview-session-item"
                           [class.has-conflict]="hasSessionConflict(session.id, preview.conflicts)">
                        <div class="session-preview-info">
                          <div class="session-preview-name">{{ session.name }}</div>
                          <div class="session-preview-meta">{{ session.videoTitle }} ‚Ä¢ {{ session.loops.length }} boucle{{ session.loops.length !== 1 ? 's' : '' }}</div>
                        </div>
                        @if (hasSessionConflict(session.id, preview.conflicts)) {
                          <div class="conflict-indicator">
                            <span class="conflict-icon">‚ö†Ô∏è</span>
                            <span class="conflict-text">Conflit</span>
                          </div>
                        }
                      </div>
                    }
                    @if (preview.sessions.length > 5) {
                      <div class="preview-more">
                        ... et {{ preview.sessions.length - 5 }} autres sessions
                      </div>
                    }
                  </div>
                </div>
              }

              <!-- Error List -->
              @if (preview.errors.length > 0) {
                <div class="error-list">
                  <h5 class="error-title">Erreurs d√©tect√©es :</h5>
                  <ul class="error-items">
                    @for (error of preview.errors; track $index) {
                      <li class="error-item">{{ error }}</li>
                    }
                  </ul>
                </div>
              }
            </div>

            <!-- Preview Actions -->
            <div class="preview-actions">
              <button 
                class="preview-btn cancel"
                (click)="cancelImport()"
                type="button">
                <span class="btn-icon">‚úï</span>
                Annuler
              </button>
              
              <button 
                class="preview-btn confirm primary"
                [disabled]="!canConfirmImport() || isImporting()"
                (click)="confirmImport()"
                type="button">
                @if (isImporting()) {
                  <span class="btn-spinner"></span>
                  Import en cours...
                } @else {
                  <span class="btn-icon">‚úì</span>
                  Confirmer l'import
                }
              </button>
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Operation Result -->
  @if (operationResult(); as result) {
    <div class="result-section">
      <div class="result-card"
           [class]="getOperationStatusClass()"
           role="alert">
        <div class="result-header">
          <span class="result-icon">{{ getOperationStatusIcon() }}</span>
          <span class="result-title">
            @if (result.success) {
              Op√©ration r√©ussie
            } @else {
              Erreur d'op√©ration
            }
          </span>
          <button 
            class="result-close"
            (click)="clearResult()"
            aria-label="Fermer le message"
            type="button">
            ‚úï
          </button>
        </div>
        
        <div class="result-message">
          {{ result.message }}
        </div>
        
        <!-- Additional Success Info -->
        @if (result.success && lastOperation() === 'import') {
          <div class="import-success-info">
            <div class="success-tip">
              üí° Les sessions import√©es sont maintenant disponibles dans votre liste.
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Storage Information -->
  <div class="storage-info-section">
    <div class="storage-info">
      <h4 class="storage-title">
        <span class="storage-icon">üíæ</span>
        Informations de stockage
      </h4>
      
      @if (sessionFacade.getStorageInfo(); as info) {
        <div class="storage-stats">
          <div class="storage-stat">
            <span class="stat-label">Sessions :</span>
            <span class="stat-value">{{ sessionCount() }}</span>
          </div>
          <div class="storage-stat">
            <span class="stat-label">Espace utilis√© :</span>
            <span class="stat-value">{{ getFormattedFileSize(info.currentSize || 0) }}</span>
          </div>
          @if (info.currentSize) {
            <div class="storage-stat">
              <span class="stat-label">Donn√©es sessions :</span>
              <span class="stat-value">{{ getFormattedFileSize(info.currentSize) }}</span>
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- Help Section -->
  <div class="help-section">
    <details class="help-details">
      <summary class="help-summary">
        <span class="help-icon">‚ùì</span>
        Aide sur l'export/import
      </summary>
      
      <div class="help-content">
        <div class="help-item">
          <h5 class="help-item-title">Export :</h5>
          <ul class="help-list">
            <li>Les fichiers export√©s contiennent toutes les donn√©es de vos sessions</li>
            <li>Format JSON standard compatible avec d'autres instances de l'application</li>
            <li>Les exports incluent les boucles, param√®tres et m√©tadonn√©es</li>
          </ul>
        </div>
        
        <div class="help-item">
          <h5 class="help-item-title">Import :</h5>
          <ul class="help-list">
            <li>Supporte les fichiers JSON export√©s depuis cette application</li>
            <li>Les sessions import√©es re√ßoivent de nouveaux identifiants uniques</li>
            <li>Glissez-d√©posez ou utilisez le bouton pour s√©lectionner un fichier</li>
            <li>Taille maximale : 10MB</li>
          </ul>
        </div>
      </div>
    </details>
  </div>
</div>