<form [formGroup]="loopForm" (ngSubmit)="onSubmit()" class="loop-form">
  <div class="form-header">
    <h3 class="form-title">{{ formTitle }}</h3>
  </div>

  <div class="form-body">
    <!-- Nom de la boucle -->
    <div class="form-group">
      <label for="name" class="form-label">Nom de la boucle</label>
      <input
        type="text"
        id="name"
        formControlName="name"
        class="form-input"
        [class.error]="nameControl?.invalid && nameControl?.touched"
        placeholder="Ex: Solo guitare"
      />
      @if (nameControl?.invalid && nameControl?.touched) {
        <span class="error-message">{{ getNameErrorMessage() }}</span>
      }
    </div>

    <!-- Temps de début et fin -->
    <div class="time-inputs-group">
      <div class="form-group half-width">
        <label for="startTime" class="form-label">Début</label>
        <input
          type="text"
          id="startTime"
          formControlName="startTimeText"
          class="form-input time-input"
          [class.error]="startTimeControl?.invalid && startTimeControl?.touched"
          placeholder="0:00"
        />
        @if (startTimeControl?.invalid && startTimeControl?.touched) {
          <span class="error-message">{{ getStartTimeErrorMessage() }}</span>
        }
      </div>

      <div class="form-group half-width">
        <label for="endTime" class="form-label">Fin</label>
        <input
          type="text"
          id="endTime"
          formControlName="endTimeText"
          class="form-input time-input"
          [class.error]="endTimeControl?.invalid && endTimeControl?.touched"
          placeholder="0:30"
        />
        @if (endTimeControl?.invalid && endTimeControl?.touched) {
          <span class="error-message">{{ getEndTimeErrorMessage() }}</span>
        }
      </div>
    </div>

    <!-- Vitesse de lecture -->
    <div class="form-group">
      <label for="playbackSpeed" class="form-label">Vitesse de lecture</label>
      <select
        id="playbackSpeed"
        formControlName="playbackSpeed"
        class="form-select"
        [class.error]="playbackSpeedControl?.invalid && playbackSpeedControl?.touched"
      >
        @for (option of speedOptions; track option.value) {
          <option [value]="option.value">{{ option.label }}</option>
        }
      </select>
    </div>

    <!-- Nombre de répétitions -->
    <div class="form-group">
      <label for="repeatCount" class="form-label">Répétitions</label>
      <input
        type="number"
        id="repeatCount"
        formControlName="repeatCount"
        class="form-input"
        [class.error]="repeatCountControl?.invalid && repeatCountControl?.touched"
        min="1"
        max="100"
      />
      @if (repeatCountControl?.invalid && repeatCountControl?.touched) {
        <span class="error-message">Le nombre de répétitions doit être entre 1 et 100</span>
      }
    </div>

    <!-- Couleur -->
    <div class="form-group">
      <label for="color" class="form-label">Couleur</label>
      <div class="color-selector">
        @for (colorOption of colorOptions; track colorOption.value) {
          <button
            type="button"
            class="color-option"
            [class.selected]="colorControl?.value === colorOption.value"
            [style.background-color]="colorOption.value"
            (click)="colorControl?.setValue(colorOption.value)"
            [attr.aria-label]="colorOption.label"
          >
            @if (colorControl?.value === colorOption.value) {
              <span class="color-checkmark">✓</span>
            }
          </button>
        }
      </div>
    </div>

    <!-- Erreurs générales du formulaire -->
    @if (loopForm.invalid && loopForm.touched) {
      <div class="form-errors">
        @if (getFormErrorMessage()) {
          <span class="error-message">{{ getFormErrorMessage() }}</span>
        }
      </div>
    }
  </div>

  <div class="form-footer">
    <button
      type="button"
      class="btn btn-secondary"
      (click)="onCancel()"
    >
      Annuler
    </button>
    
    <button
      type="submit"
      class="btn btn-primary"
      [disabled]="loopForm.invalid"
    >
      {{ isEditMode ? 'Modifier' : 'Créer' }}
    </button>
  </div>
</form>
