<div class="loop-list">
  <div class="list-header">
    <h3 class="list-title">Boucles ({{ vm().totalLoops }})</h3>
    @if (vm().hasLoops) {
      <span class="list-summary">
        {{ vm().totalLoops }} boucle{{ vm().totalLoops > 1 ? 's' : '' }}
        @if (vm().activeLoop) {
          ‚Ä¢ <span class="active-indicator">{{ vm().activeLoop!.name }} active</span>
        }
      </span>
    }
  </div>

  @if (vm().hasLoops) {
    <div class="loops-grid">
      @for (loop of sortedLoops(); track loop.id; let i = $index) {
        <div 
          class="loop-card"
          [class.active]="isActiveLoop(loop)"
          [class.playing]="isActiveLoop(loop) && vm().isLooping"
          [attr.data-loop-id]="loop.id"
          (click)="onLoopCardClick($event, loop, i)"
          (keydown.enter)="onLoopCardClick($event, loop, i)"
          (keydown.space)="onLoopCardClick($event, loop, i)"
          tabindex="0"
          role="button"
          [attr.aria-label]="'Boucle ' + (loop.name || loop.id) + ' de ' + formatTimeRange(loop) + ', dur√©e ' + formatDuration(calculateDuration(loop)) + (isActiveLoop(loop) ? ', active' : '')"
          [attr.aria-pressed]="isActiveLoop(loop)"
        >
          <!-- Indicateur de couleur -->
          <div 
            class="loop-color-indicator"
            [style.background-color]="loop.color || '#3B82F6'"
          ></div>

          <!-- Contenu principal -->
          <div class="loop-content">
            <div class="loop-main-info">
              <h4 class="loop-name">{{ loop.name }}</h4>
              <div class="loop-time-info">
                <span class="time-range">{{ formatTimeRange(loop) }}</span>
                <span class="duration">{{ formatDuration(calculateDuration(loop)) }}</span>
              </div>
            </div>

            <div class="loop-meta">
              <div class="loop-properties">
                <span class="property speed">
                  <span class="property-icon">‚ö°</span>
                  {{ getSpeedLabel(loop.playbackSpeed) }}
                </span>
                <span class="property repeats">
                  <span class="property-icon">üîÑ</span>
                  {{ getRepeatLabel(loop.repeatCount) }}
                </span>
                @if (loop.playCount > 0) {
                  <span class="property plays">
                    <span class="property-icon">‚ñ∂Ô∏è</span>
                    {{ loop.playCount }} lecture{{ loop.playCount > 1 ? 's' : '' }}
                  </span>
                }
              </div>
            </div>
          </div>

          <!-- Actions (affich√©es au hover) -->
          <div class="loop-actions">
            <button 
              class="action-btn play-btn"
              [class.active]="isActiveLoop(loop) && vm().isLooping"
              (click)="onActionClick($event, 'play', loop, i)"
              [attr.aria-label]="(isActiveLoop(loop) && vm().isLooping ? 'Arr√™ter la boucle' : 'Lire la boucle') + ' (P)'"
              tabindex="-1"
            >
              @if (isActiveLoop(loop) && vm().isLooping) {
                <span class="icon">‚è∏Ô∏è</span>
              } @else {
                <span class="icon">‚ñ∂Ô∏è</span>
              }
            </button>

            <button 
              class="action-btn edit-btn"
              (click)="onActionClick($event, 'edit', loop, i)"
              [attr.aria-label]="'Modifier la boucle (E)'"
              tabindex="-1"
            >
              <span class="icon">‚úèÔ∏è</span>
            </button>

            <button 
              class="action-btn duplicate-btn"
              (click)="onActionClick($event, 'duplicate', loop, i)"
              [attr.aria-label]="'Dupliquer la boucle (D)'"
              tabindex="-1"
            >
              <span class="icon">üìã</span>
            </button>

            <button 
              class="action-btn delete-btn"
              (click)="onActionClick($event, 'delete', loop, i)"
              [attr.aria-label]="'Supprimer la boucle (Delete)'"
              tabindex="-1"
            >
              <span class="icon">üóëÔ∏è</span>
            </button>
          </div>

          <!-- Indicateur de statut actif -->
          @if (isActiveLoop(loop)) {
            <div class="active-status">
              @if (vm().isLooping) {
                <span class="status-icon playing">üîä</span>
                <span class="status-text">En cours</span>
              } @else {
                <span class="status-icon selected">‚úì</span>
                <span class="status-text">S√©lectionn√©e</span>
              }
            </div>
          }
        </div>
      }
    </div>
  } @else {
    <div class="empty-state">
      <div class="empty-icon">üéµ</div>
      <h3 class="empty-title">Aucune boucle</h3>
      <p class="empty-description">
        Cr√©ez votre premi√®re boucle pour commencer √† pratiquer des segments sp√©cifiques.
      </p>
    </div>
  }
</div>
